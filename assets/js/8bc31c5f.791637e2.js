"use strict";(self.webpackChunkneuraltrust_docs=self.webpackChunkneuraltrust_docs||[]).push([[4414],{13071:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"ai-gateway/plugins/rate-limiting","title":"Rate Limiting","description":"TrustGate implements a sophisticated rate limiting system that operates at multiple levels and supports various limiting strategies.","source":"@site/docs/ai-gateway/plugins/rate-limiting.md","sourceDirName":"ai-gateway/plugins","slug":"/ai-gateway/plugins/rate-limiting","permalink":"/ai-gateway/plugins/rate-limiting","draft":false,"unlisted":false,"editUrl":"https://github.com/NeuralTrust/neuraltrust/blob/main/docs/ai-gateway/plugins/rate-limiting.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Rate Limiting"},"sidebar":"tutorialSidebar","previous":{"title":"External API Plugin","permalink":"/ai-gateway/plugins/external-api"},"next":{"title":"Token Rate Limiting","permalink":"/ai-gateway/plugins/token-rate-limiting"}}');var s=n(74848),l=n(28453);const t={sidebar_position:2,title:"Rate Limiting"},d="Rate Limiting",a={},c=[{value:"Rate Limiter Architecture",id:"rate-limiter-architecture",level:2},{value:"Basic Configuration",id:"basic-configuration",level:3},{value:"Limit Types",id:"limit-types",level:2},{value:"1. Per-IP Limiting",id:"1-per-ip-limiting",level:3},{value:"2. Per-User Limiting",id:"2-per-user-limiting",level:3},{value:"3. Global Limiting",id:"3-global-limiting",level:3},{value:"Window Configuration",id:"window-configuration",level:2},{value:"Action Configuration",id:"action-configuration",level:2},{value:"Response Headers",id:"response-headers",level:2},{value:"Per Limit Type Headers",id:"per-limit-type-headers",level:3},{value:"Rate Limit Exceeded Response",id:"rate-limit-exceeded-response",level:3},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Storage and Tracking",id:"storage-and-tracking",level:3},{value:"Counter Implementation",id:"counter-implementation",level:3},{value:"Best Practices",id:"best-practices",level:2}];function o(e){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"rate-limiting",children:"Rate Limiting"})}),"\n",(0,s.jsx)(i.p,{children:"TrustGate implements a sophisticated rate limiting system that operates at multiple levels and supports various limiting strategies."}),"\n",(0,s.jsx)(i.h2,{id:"rate-limiter-architecture",children:"Rate Limiter Architecture"}),"\n",(0,s.jsxs)(i.p,{children:["The rate limiter operates in the ",(0,s.jsx)(i.code,{children:"pre_request"})," stage and evaluates limits in the following order:"]}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsx)(i.li,{children:"Per-IP limits"}),"\n",(0,s.jsx)(i.li,{children:"Per-User limits"}),"\n",(0,s.jsx)(i.li,{children:"Global limits"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/api/v1/gateways/{gateway-id} \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "required_plugins": [\n      {\n        "name": "rate_limiter",\n        "enabled": true,\n        "stage": "pre_request",\n        "priority": 1,\n        "settings": {\n          "limits": {\n            "global": {\n              "limit": 15,\n              "window": "1m"\n            },\n            "per_ip": {\n              "limit": 5,\n              "window": "1m"\n            },\n            "per_user": {\n              "limit": 5,\n              "window": "1m"\n            }\n          },\n          "actions": {\n            "type": "reject",\n            "retry_after": "60"\n          }\n        }\n      }\n    ]\n  }\'\n'})}),"\n",(0,s.jsx)(i.h2,{id:"limit-types",children:"Limit Types"}),"\n",(0,s.jsx)(i.h3,{id:"1-per-ip-limiting",children:"1. Per-IP Limiting"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'"per_ip": {\n  "limit": 5,\n  "window": "1m"\n}\n'})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Tracks requests by IP address"}),"\n",(0,s.jsxs)(i.li,{children:["Supports multiple IP headers for proxy environments:","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"X-Real-IP"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"X-Forwarded-For"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"X-Original-Forwarded-For"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"True-Client-IP"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"CF-Connecting-IP"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"2-per-user-limiting",children:"2. Per-User Limiting"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'"per_user": {\n  "limit": 5,\n  "window": "1m"\n}\n'})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Tracks requests by user identifier"}),"\n",(0,s.jsxs)(i.li,{children:["Supports multiple user ID headers:","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"X-User-ID"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"X-User-Id"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"X-UserID"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"User-ID"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.li,{children:'Falls back to "anonymous" if no user ID is found'}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"3-global-limiting",children:"3. Global Limiting"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'"global": {\n  "limit": 15,\n  "window": "1m"\n}\n'})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Applies to all requests across the gateway"}),"\n",(0,s.jsx)(i.li,{children:"Used for overall traffic control"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"window-configuration",children:"Window Configuration"}),"\n",(0,s.jsxs)(i.p,{children:["The ",(0,s.jsx)(i.code,{children:"window"})," parameter supports any valid duration string:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"s"}),': seconds (e.g., "30s")']}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"m"}),': minutes (e.g., "5m")']}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"h"}),': hours (e.g., "1h")']}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"d"}),': days (e.g., "1d")']}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Example combinations:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'{\n  "limits": {\n    "per_ip": {\n      "limit": 30,\n      "window": "30s"\n    },\n    "per_user": {\n      "limit": 100,\n      "window": "1h"\n    },\n    "global": {\n      "limit": 1000,\n      "window": "1d"\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(i.h2,{id:"action-configuration",children:"Action Configuration"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'"actions": {\n  "type": "reject",\n  "retry_after": "60"\n}\n'})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"type"}),":","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"reject"}),": Returns 429 status with retry information"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"block"}),": Similar to reject but for permanent blocks"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"retry_after"}),": Seconds to wait before retrying"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"response-headers",children:"Response Headers"}),"\n",(0,s.jsx)(i.p,{children:"The rate limiter adds the following headers to each response:"}),"\n",(0,s.jsx)(i.h3,{id:"per-limit-type-headers",children:"Per Limit Type Headers"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"X-RateLimit-{type}-Limit: [maximum requests]\nX-RateLimit-{type}-Remaining: [requests remaining]\nX-RateLimit-{type}-Reset: [reset timestamp]\n"})}),"\n",(0,s.jsxs)(i.p,{children:["Where ",(0,s.jsx)(i.code,{children:"{type}"})," is one of:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"global"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"per_ip"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.code,{children:"per_user"})}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"rate-limit-exceeded-response",children:"Rate Limit Exceeded Response"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-json",children:'{\n  "error": "per_ip rate limit exceeded",\n  "retry_after": "60"\n}\n'})}),"\n",(0,s.jsx)(i.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,s.jsx)(i.h3,{id:"storage-and-tracking",children:"Storage and Tracking"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Uses Redis sorted sets for tracking"}),"\n",(0,s.jsxs)(i.li,{children:["Key format: ",(0,s.jsx)(i.code,{children:"ratelimit:{level}:{id}:{limit_type}:{key}"})]}),"\n",(0,s.jsx)(i.li,{children:"Automatic cleanup of expired entries"}),"\n",(0,s.jsx)(i.li,{children:"Thread-safe operations"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"counter-implementation",children:"Counter Implementation"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-go",children:'requestID := fmt.Sprintf("%d:%s", now.Unix(), uuid.New().String())\npipe := redis.Pipeline()\npipe.ZRemRangeByScore(ctx, key, "0", windowStart)\npipe.ZAdd(ctx, key, &redis.Z{\n    Score:  float64(now.Unix()),\n    Member: requestID,\n})\npipe.Expire(ctx, key, window)\n'})}),"\n",(0,s.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.strong,{children:"Layered Protection"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Configure all three limit types"}),"\n",(0,s.jsx)(i.li,{children:"Use shorter windows for per-IP limits"}),"\n",(0,s.jsx)(i.li,{children:"Use longer windows for global limits"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.strong,{children:"Header Configuration"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Ensure proper forwarding of IP headers in proxy setups"}),"\n",(0,s.jsx)(i.li,{children:"Configure user ID headers for accurate user tracking"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.strong,{children:"Window Sizing"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Per-IP: 10s-1m windows for abuse prevention"}),"\n",(0,s.jsx)(i.li,{children:"Per-User: 1m-1h windows for fair usage"}),"\n",(0,s.jsx)(i.li,{children:"Global: 1m-24h windows for capacity planning"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.strong,{children:"Monitoring"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Track rate limit headers for usage patterns"}),"\n",(0,s.jsx)(i.li,{children:"Monitor 429 responses for limit adjustments"}),"\n",(0,s.jsx)(i.li,{children:"Implement client-side backoff strategies"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>t,x:()=>d});var r=n(96540);const s={},l=r.createContext(s);function t(e){const i=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(l.Provider,{value:i},e.children)}}}]);