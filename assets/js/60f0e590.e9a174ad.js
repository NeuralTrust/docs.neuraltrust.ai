"use strict";(self.webpackChunkneuraltrust_docs=self.webpackChunkneuraltrust_docs||[]).push([[7362],{6354:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"trustgate/concepts/rules","title":"Rules","description":"A rule in AI Gateway determines how incoming requests are matched and forwarded to services. Rules act as the traffic routing configuration that maps incoming requests to the appropriate services based on paths, methods, and other conditions.","source":"@site/docs/trustgate/concepts/rules.md","sourceDirName":"trustgate/concepts","slug":"/trustgate/concepts/rules","permalink":"/trustgate/concepts/rules","draft":false,"unlisted":false,"editUrl":"https://github.com/NeuralTrust/neuraltrust/blob/main/docs/trustgate/concepts/rules.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Rules"},"sidebar":"tutorialSidebar","previous":{"title":"Upstreams","permalink":"/trustgate/concepts/upstreams"},"next":{"title":"Plugins","permalink":"/trustgate/concepts/plugins"}}');var n=s(4848),r=s(8453);const a={sidebar_position:4,title:"Rules"},l="Rules",o={},c=[{value:"Rule Components",id:"rule-components",level:2},{value:"Rule Matching",id:"rule-matching",level:2},{value:"Path Matching",id:"path-matching",level:3},{value:"Method Matching",id:"method-matching",level:3},{value:"Header Matching",id:"header-matching",level:3},{value:"Path Handling",id:"path-handling",level:2},{value:"Strip Path",id:"strip-path",level:3},{value:"Preserve Host",id:"preserve-host",level:3},{value:"Rule Priority",id:"rule-priority",level:2},{value:"Exact Match Priority",id:"exact-match-priority",level:3},{value:"Method Specificity",id:"method-specificity",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"rules",children:"Rules"})}),"\n",(0,n.jsx)(t.p,{children:"A rule in AI Gateway determines how incoming requests are matched and forwarded to services. Rules act as the traffic routing configuration that maps incoming requests to the appropriate services based on paths, methods, and other conditions."}),"\n",(0,n.jsx)(t.h2,{id:"rule-components",children:"Rule Components"}),"\n",(0,n.jsx)(t.p,{children:"A rule consists of:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Path: The URL path pattern to match"}),"\n",(0,n.jsx)(t.li,{children:"Service ID: The service that will handle matched requests"}),"\n",(0,n.jsx)(t.li,{children:"Methods: Allowed HTTP methods"}),"\n",(0,n.jsx)(t.li,{children:"Strip Path: Whether to remove the matched path prefix"}),"\n",(0,n.jsx)(t.li,{children:"Active: Whether the rule is currently active"}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"rule-matching",children:"Rule Matching"}),"\n",(0,n.jsx)(t.p,{children:"Rules determine how requests are matched to services through three main matching mechanisms:"}),"\n",(0,n.jsx)(t.h3,{id:"path-matching",children:"Path Matching"}),"\n",(0,n.jsxs)(t.p,{children:["The path matching system provides multiple strategies for routing requests based on URL patterns. ",(0,n.jsx)(t.strong,{children:"Exact path matching"})," provides the most precise control, ensuring requests match specific URLs exactly as configured. For more flexible routing, the system supports ",(0,n.jsx)(t.strong,{children:"prefix matching with wildcards"}),", allowing a single rule to capture multiple similar paths. More complex routing needs can be addressed using ",(0,n.jsx)(t.strong,{children:"regular expression patterns"}),", enabling sophisticated pattern matching for special use cases. The system employs ",(0,n.jsx)(t.strong,{children:"priority-based selection"})," when multiple patterns match, ensuring the most specific and appropriate rule is selected for each request."]}),"\n",(0,n.jsx)(t.h3,{id:"method-matching",children:"Method Matching"}),"\n",(0,n.jsxs)(t.p,{children:["Method matching controls how HTTP methods are handled for each route. Rules can be configured to accept ",(0,n.jsx)(t.strong,{children:"specific HTTP methods"}),", ensuring endpoints only respond to intended operations. The system supports ",(0,n.jsx)(t.strong,{children:"multiple method support"}),", allowing a single rule to handle different types of requests on the same path. Administrators can implement ",(0,n.jsx)(t.strong,{children:"method restrictions"})," to limit which HTTP operations are allowed, providing an additional layer of security and control over API access."]}),"\n",(0,n.jsx)(t.h3,{id:"header-matching",children:"Header Matching"}),"\n",(0,n.jsxs)(t.p,{children:["Header matching provides advanced request routing based on HTTP headers. Rules can ",(0,n.jsx)(t.strong,{children:"match based on headers"}),", allowing routing decisions to be made on factors like API versions, client types, or custom metadata. The system includes ",(0,n.jsx)(t.strong,{children:"support for multiple headers"}),", enabling complex routing scenarios based on combinations of header values. ",(0,n.jsx)(t.strong,{children:"Regular expression patterns"})," can be applied to header values, providing flexible matching capabilities for complex header-based routing requirements."]}),"\n",(0,n.jsx)(t.h2,{id:"path-handling",children:"Path Handling"}),"\n",(0,n.jsx)(t.p,{children:"Rules provide several path handling options:"}),"\n",(0,n.jsx)(t.h3,{id:"strip-path",children:"Strip Path"}),"\n",(0,n.jsx)(t.p,{children:"When enabled, removes the matched portion of the path before forwarding:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"Request: /api/v1/chat/completions\nMatched Path: /api/v1\nForwarded Path: /chat/completions\n"})}),"\n",(0,n.jsx)(t.h3,{id:"preserve-host",children:"Preserve Host"}),"\n",(0,n.jsx)(t.p,{children:"Controls whether to forward the original Host header to the upstream service."}),"\n",(0,n.jsx)(t.h2,{id:"rule-priority",children:"Rule Priority"}),"\n",(0,n.jsx)(t.p,{children:"When multiple rules match a request, the AI Gateway employs a sophisticated priority system to determine which rule should be applied:"}),"\n",(0,n.jsx)(t.h3,{id:"exact-match-priority",children:"Exact Match Priority"}),"\n",(0,n.jsxs)(t.p,{children:["The system prioritizes precision and specificity in path matching to ensure the most appropriate rule is selected. ",(0,n.jsx)(t.strong,{children:"Exact paths take precedence"})," over pattern-based matches, providing the highest level of routing precision. When comparing similar paths, the system follows a length-based hierarchy where ",(0,n.jsx)(t.strong,{children:"longer paths are preferred over shorter"})," ones, as they typically represent more specific endpoints. This approach ensures that ",(0,n.jsx)(t.strong,{children:"more specific matches win"})," in cases where multiple rules could apply, preventing ambiguous routing situations and maintaining precise control over request handling."]}),"\n",(0,n.jsx)(t.h3,{id:"method-specificity",children:"Method Specificity"}),"\n",(0,n.jsxs)(t.p,{children:["HTTP method matching follows a clear hierarchy in determining rule priority. Rules with ",(0,n.jsx)(t.strong,{children:"method-specific rules"})," are given higher priority, as they represent more precisely defined routing intentions. At the lowest priority level are rules with ",(0,n.jsx)(t.strong,{children:"ALL methods"}),", providing a catch-all mechanism for general routing scenarios. The system ensures that ",(0,n.jsx)(t.strong,{children:"explicit methods take precedence over wildcards"}),", allowing for precise method-based routing while maintaining flexibility through wildcard rules when needed. This hierarchical approach to method matching ensures that requests are handled by the most specifically defined rules while still providing fallback options for more general cases."]}),"\n",(0,n.jsx)(t.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Path Design"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Use clear path hierarchies"}),"\n",(0,n.jsx)(t.li,{children:"Consider versioning in paths"}),"\n",(0,n.jsx)(t.li,{children:"Document path patterns"}),"\n",(0,n.jsx)(t.li,{children:"Keep paths consistent"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Method Configuration"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Restrict to needed methods"}),"\n",(0,n.jsx)(t.li,{children:"Document method requirements"}),"\n",(0,n.jsx)(t.li,{children:"Consider security implications"}),"\n",(0,n.jsx)(t.li,{children:"Use appropriate verbs"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Rule Organization"})}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Group related rules"}),"\n",(0,n.jsx)(t.li,{children:"Maintain clear priorities"}),"\n",(0,n.jsx)(t.li,{children:"Document rule purposes"}),"\n",(0,n.jsx)(t.li,{children:"Keep rules simple"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/trustgate/concepts/services",children:"Learn about Services"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/trustgate/concepts/plugins",children:"Understand Plugins"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/trustgate/concepts/consumer-groups",children:"Configure Consumer Groups"})}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>l});var i=s(6540);const n={},r=i.createContext(n);function a(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);