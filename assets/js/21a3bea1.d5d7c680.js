"use strict";(self.webpackChunkneuraltrust_docs=self.webpackChunkneuraltrust_docs||[]).push([[925],{73886:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"ai-gateway/guides/provider-load-balancing","title":"Balancing AI Providers","description":"This guide demonstrates how to set up load balancing between multiple AI providers in TrustGate. By distributing traffic across different providers, you can improve reliability, optimize costs, and ensure high availability for your AI applications.","source":"@site/docs/ai-gateway/guides/provider-load-balancing.md","sourceDirName":"ai-gateway/guides","slug":"/ai-gateway/guides/provider-load-balancing","permalink":"/ai-gateway/guides/provider-load-balancing","draft":false,"unlisted":false,"editUrl":"https://github.com/NeuralTrust/neuraltrust/blob/main/docs/ai-gateway/guides/provider-load-balancing.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Balancing AI Providers","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Open AI Token-Based Rate Limiting","permalink":"/ai-gateway/guides/token-rate-limiting"},"next":{"title":"Plugins","permalink":"/category/plugins"}}');var s=i(74848),t=i(28453);const a={title:"Balancing AI Providers",sidebar_position:4},l="Load Balancing Between AI Providers",o={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create a Gateway",id:"step-1-create-a-gateway",level:2},{value:"Step 2: Configure Multi-Provider Upstream",id:"step-2-configure-multi-provider-upstream",level:2},{value:"Configuration Parameters",id:"configuration-parameters",level:3},{value:"Step 3: Create a Service",id:"step-3-create-a-service",level:2},{value:"Step 4: Add a Rule",id:"step-4-add-a-rule",level:2},{value:"Step 5: Generate an API Key",id:"step-5-generate-an-api-key",level:2},{value:"Using the Load Balanced API",id:"using-the-load-balanced-api",level:2},{value:"Response Headers",id:"response-headers",level:3},{value:"Load Balancing Features",id:"load-balancing-features",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"load-balancing-between-ai-providers",children:"Load Balancing Between AI Providers"})}),"\n",(0,s.jsx)(n.p,{children:"This guide demonstrates how to set up load balancing between multiple AI providers in TrustGate. By distributing traffic across different providers, you can improve reliability, optimize costs, and ensure high availability for your AI applications."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"TrustGate installed and running"}),"\n",(0,s.jsx)(n.li,{children:"API keys for multiple providers (e.g., OpenAI and Anthropic)"}),"\n",(0,s.jsx)(n.li,{children:"Basic understanding of load balancing concepts"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-1-create-a-gateway",children:"Step 1: Create a Gateway"}),"\n",(0,s.jsx)(n.p,{children:"First, create a gateway that will handle the load balancing:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/api/v1/gateways" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "multi-provider-gateway",\n    "subdomain": "your-subdomain"\n  }\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"step-2-configure-multi-provider-upstream",children:"Step 2: Configure Multi-Provider Upstream"}),"\n",(0,s.jsx)(n.p,{children:"Set up an upstream that includes multiple AI providers. This example demonstrates load balancing between OpenAI and Anthropic:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/api/v1/gateways/{gateway_id}/upstreams" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "ai-providers-upstream",\n    "algorithm": "round-robin",\n    "targets": [\n      {\n        "path": "/v1/chat/completions",\n        "provider": "openai",\n        "weight": 50,\n        "priority": 1,\n        "default_model": "gpt-4",\n        "models": ["gpt-3.5-turbo", "gpt-4"],\n        "credentials": {\n          "header_name": "Authorization",\n          "header_value": "Bearer your-openai-key"\n        }\n      },\n      {\n        "path": "/v1/messages",\n        "provider": "anthropic",\n        "weight": 50,\n        "priority": 1,\n        "default_model": "claude-3-sonnet",\n        "models": ["claude-3-sonnet"],\n        "headers": {\n          "anthropic-version": "2023-06-01"\n        },\n        "credentials": {\n          "header_name": "x-api-key",\n          "header_value": "your-anthropic-key"\n        }\n      }\n    ],\n    "health_checks": {\n      "passive": true,\n      "threshold": 3,\n      "interval": 60\n    }\n  }\'\n'})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-parameters",children:"Configuration Parameters"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"algorithm"}),": Load balancing algorithm (e.g., round-robin)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"weight"}),": Relative traffic distribution weight for each target"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"priority"}),": Failover priority (lower numbers have higher priority)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"path"}),": Provider-specific API endpoint path"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"provider"}),": AI provider identifier"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"models"}),": List of supported models for each provider"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"default_model"}),": Default model when none is specified"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"headers"}),": Provider-specific headers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"credentials"}),": Authentication credentials for each provider"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-3-create-a-service",children:"Step 3: Create a Service"}),"\n",(0,s.jsx)(n.p,{children:"Create a service that uses the multi-provider upstream:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/api/v1/gateways/{gateway_id}/services" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "ai-chat-service",\n    "description": "Load balanced AI chat completion service",\n    "upstream_id": "{upstream_id}",\n    "type": "upstream",\n    "tags": ["ai", "chat"]\n  }\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"step-4-add-a-rule",children:"Step 4: Add a Rule"}),"\n",(0,s.jsx)(n.p,{children:"Configure a rule to route requests to your service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/api/v1/gateways/{gateway_id}/rules" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "path": "/v1",\n    "service_id": "{service_id}",\n    "methods": ["POST"],\n    "strip_path": false,\n    "active": true\n  }\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"step-5-generate-an-api-key",children:"Step 5: Generate an API Key"}),"\n",(0,s.jsx)(n.p,{children:"Create an API key for authentication:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8080/api/v1/gateways/{gateway_id}/keys" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "test-key",\n    "expires_at": "2026-01-01T00:00:00Z"\n  }\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"using-the-load-balanced-api",children:"Using the Load Balanced API"}),"\n",(0,s.jsx)(n.p,{children:"When making requests to your load-balanced API, TrustGate automatically handles provider selection and request transformation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST "http://localhost:8081/v1/chat/completions" \\\n  -H "Content-Type: application/json" \\\n  -H "Host: your-subdomain.example.com" \\\n  -H "X-Api-Key: your-api-key" \\\n  -d \'{\n    "model": "gpt-4",\n    "messages": [\n      {\n        "role": "user",\n        "content": "Hello, how are you?"\n      }\n    ],\n    "max_tokens": 1020,\n    "system": "You are an assistant",\n    "stream": true\n  }\'\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.p,{children:"When using multiple providers in an upstream, you need to include fields that cover all providers in your request. The gateway will automatically transform the request for the selected provider."}),(0,s.jsx)(n.p,{children:"For example, when load balancing between OpenAI and Anthropic:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "model": "gpt-4",\n  "messages": [\n    {\n      "role": "user",\n      "content": "Hello!"\n    }\n  ],\n  "max_tokens": 1020,\n  "system": "You are an assistant"\n}\n'})}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"The fields in this request serve different purposes:\n- `model` and `messages`: OpenAI format\n- `system`: Anthropic system prompt\n- `max_tokens`: Common field for both providers\n\nThe gateway will:\n1. Select a target based on the load balancing algorithm\n2. Transform the request to match the selected provider's format\n3. Remove unnecessary fields for that provider\n4. Add any required provider-specific headers\n5. Use the default model for the selected provider if different from the request\n\nYou don't need to handle the transformation yourself - just include all necessary fields in your request, and the gateway will handle the rest based on the provider schemas.\n\nFor streaming requests, add `\"stream\": true` to enable streaming for all providers.\n\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"response-headers",children:"Response Headers"}),"\n",(0,s.jsx)(n.p,{children:"The API returns headers indicating which provider was selected:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"X-Selected-Provider"}),": The provider that handled the request"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"load-balancing-features",children:"Load Balancing Features"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Weighted Distribution"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Configure traffic distribution using weights"}),"\n",(0,s.jsx)(n.li,{children:"Adjust weights based on provider costs or performance"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Failover Support"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Set priority levels for providers"}),"\n",(0,s.jsx)(n.li,{children:"Automatic failover when primary provider fails"}),"\n",(0,s.jsx)(n.li,{children:"Health checks for provider availability"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request Transformation"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Automatic conversion between provider formats"}),"\n",(0,s.jsx)(n.li,{children:"Model name mapping"}),"\n",(0,s.jsx)(n.li,{children:"Request/response adaptation"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Health Monitoring"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Passive health checks"}),"\n",(0,s.jsx)(n.li,{children:"Configurable failure thresholds"}),"\n",(0,s.jsx)(n.li,{children:"Automatic provider recovery"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Provider Selection"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Choose complementary providers"}),"\n",(0,s.jsx)(n.li,{children:"Consider provider strengths and pricing"}),"\n",(0,s.jsx)(n.li,{children:"Match models across providers"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Load Distribution"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Balance cost vs. performance"}),"\n",(0,s.jsx)(n.li,{children:"Monitor provider quotas"}),"\n",(0,s.jsx)(n.li,{children:"Adjust weights based on usage patterns"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Error Handling"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Implement proper fallback logic"}),"\n",(0,s.jsx)(n.li,{children:"Monitor provider errors"}),"\n",(0,s.jsx)(n.li,{children:"Set appropriate timeouts"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request Design"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use provider-agnostic request format"}),"\n",(0,s.jsx)(n.li,{children:"Include all required fields for both providers"}),"\n",(0,s.jsx)(n.li,{children:"Handle provider-specific features gracefully"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:"If you encounter issues:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Check provider selection headers"}),"\n",(0,s.jsx)(n.li,{children:"Verify provider health status"}),"\n",(0,s.jsx)(n.li,{children:"Review load balancing configuration"}),"\n",(0,s.jsx)(n.li,{children:"Monitor provider error responses"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Set up monitoring for provider metrics"}),"\n",(0,s.jsx)(n.li,{children:"Configure provider-specific rate limits"}),"\n",(0,s.jsx)(n.li,{children:"Implement cost optimization strategies"}),"\n",(0,s.jsx)(n.li,{children:"Add more providers for redundancy"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var r=i(96540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);