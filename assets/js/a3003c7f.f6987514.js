"use strict";(self.webpackChunkneuraltrust_docs=self.webpackChunkneuraltrust_docs||[]).push([[7146],{3423:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"ai-gateway/concepts/forwarding-rules","title":"Forwarding Rules","description":"Forwarding rules are a core feature of the AI Gateway that define how incoming requests are routed to various AI providers. Each rule is uniquely identified by a UUID and contains essential routing configuration including path patterns, HTTP methods, headers, and plugin chains.","source":"@site/docs/ai-gateway/concepts/forwarding-rules.md","sourceDirName":"ai-gateway/concepts","slug":"/ai-gateway/concepts/forwarding-rules","permalink":"/neuraltrust/ai-gateway/concepts/forwarding-rules","draft":false,"unlisted":false,"editUrl":"https://github.com/NeuralTrust/neuraltrust/blob/main/docs/ai-gateway/concepts/forwarding-rules.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"AI Gateway Concepts","permalink":"/neuraltrust/category/ai-gateway-concepts"},"next":{"title":"Plugin System","permalink":"/neuraltrust/ai-gateway/concepts/plugin-system"}}');var t=i(4848),s=i(8453);const a={sidebar_position:1},l="Forwarding Rules",o={},d=[{value:"Rule Structure",id:"rule-structure",level:2},{value:"Core Fields",id:"core-fields",level:3},{value:"Behavior Controls",id:"behavior-controls",level:3},{value:"Advanced Configuration",id:"advanced-configuration",level:3},{value:"Automatic Rule Generation",id:"automatic-rule-generation",level:2},{value:"OpenAI Provider",id:"openai-provider",level:3},{value:"Anthropic Provider",id:"anthropic-provider",level:3},{value:"Custom Rules",id:"custom-rules",level:2},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Path Matching",id:"path-matching",level:3},{value:"Target Configuration",id:"target-configuration",level:3},{value:"HTTP Methods",id:"http-methods",level:3},{value:"Header Management",id:"header-management",level:3},{value:"Retry Policy",id:"retry-policy",level:3},{value:"Best Practices",id:"best-practices",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"forwarding-rules",children:"Forwarding Rules"})}),"\n",(0,t.jsx)(n.p,{children:"Forwarding rules are a core feature of the AI Gateway that define how incoming requests are routed to various AI providers. Each rule is uniquely identified by a UUID and contains essential routing configuration including path patterns, HTTP methods, headers, and plugin chains."}),"\n",(0,t.jsx)(n.h2,{id:"rule-structure",children:"Rule Structure"}),"\n",(0,t.jsx)(n.p,{children:"The rule structure defines how requests are matched and routed through the AI Gateway. Let's examine each field in detail:"}),"\n",(0,t.jsx)(n.h3,{id:"core-fields",children:"Core Fields"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"id"}),": A unique UUID identifying the forwarding rule"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"gateway_id"}),": References the gateway this rule belongs to"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"path"}),": The URL path pattern to match incoming requests (e.g., ",(0,t.jsx)(n.code,{children:"/v1/chat/completions"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"targets"}),": Array of destination endpoints where requests will be forwarded","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"url"}),": The base URL of the target API endpoint"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"methods"}),": Array of allowed HTTP methods for this rule"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"behavior-controls",children:"Behavior Controls"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"strip_path"}),": When true, removes the matched path prefix before forwarding"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"preserve_host"}),": When true, keeps the original Host header instead of rewriting it"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"retry_attempts"}),": Number of times to retry failed requests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"active"}),": Enables/disables the rule without deletion"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"public"}),": Controls whether the rule is accessible without authentication"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"headers"}),": Custom header modifications for forwarded requests"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"plugin_chain"}),": Ordered list of plugins to process requests/responses"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This structure allows for flexible routing configurations while maintaining security and reliability. Rules can be as simple as basic forwarding or complex with multiple plugins and header transformations."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "id": "uuid",\n  "gateway_id": "gateway-uuid",\n  "path": "/v1/chat/completions",\n  "targets": [\n    {"url": "https://api.openai.com"}\n  ],\n  "methods": ["POST"],\n  "headers": {},\n  "strip_path": false,\n  "preserve_host": false,\n  "retry_attempts": 0,\n  "plugin_chain": [],\n  "active": true,\n  "public": false\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"automatic-rule-generation",children:"Automatic Rule Generation"}),"\n",(0,t.jsx)(n.p,{children:'For gateways of type "models", the system automatically generates appropriate forwarding rules based on the configured provider:'}),"\n",(0,t.jsx)(n.h3,{id:"openai-provider",children:"OpenAI Provider"}),"\n",(0,t.jsx)(n.p,{children:"When using OpenAI as a provider, the AI Gateway automatically generates forwarding rules for their core API endpoints. These rules cover the essential OpenAI endpoints including chat completions, text completions, and embeddings:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "path": "/v1/chat/completions",\n  "targets": [{"url": "https://api.openai.com"}],\n  "methods": ["POST"]\n},\n{\n  "path": "/v1/completions",\n  "targets": [{"url": "https://api.openai.com"}],\n  "methods": ["POST"]\n},\n{\n  "path": "/v1/embeddings",\n  "targets": [{"url": "https://api.openai.com"}],\n  "methods": ["POST"]\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"anthropic-provider",children:"Anthropic Provider"}),"\n",(0,t.jsx)(n.p,{children:"For Anthropic provider configurations, the AI Gateway creates default forwarding rules that map to Anthropic's primary API services. The generated rules enable access to Anthropic's core functionalities, including their messages API for Claude interactions and their completions endpoint:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "path": "/v1/complete",\n  "targets": [{"url": "https://api.anthropic.com"}],\n  "methods": ["POST"]\n},\n{\n  "path": "/v1/messages",\n  "targets": [{"url": "https://api.anthropic.com"}],\n  "methods": ["POST"]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"custom-rules",children:"Custom Rules"}),"\n",(0,t.jsx)(n.p,{children:"Create custom rules for specialized routing needs by using the rules API endpoint. Custom rules allow you to define granular routing behaviors including:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Multiple target endpoints with weighted load balancing"}),"\n",(0,t.jsx)(n.li,{children:"Custom header modifications and path stripping"}),"\n",(0,t.jsx)(n.li,{children:"Retry policies for failed requests"}),"\n",(0,t.jsx)(n.li,{children:"Integration with the plugin system for additional functionality"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here's how to create a custom rule:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/api/v1/gateways/{gateway_id}/rules \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "path": "/custom/endpoint",\n    "targets": [\n      {\n        "url": "https://primary-api.example.com",\n        "weight": 80\n      },\n      {\n        "url": "https://backup-api.example.com",\n        "weight": 20\n      }\n    ],\n    "methods": ["GET", "POST"],\n    "headers": {\n      "X-Custom-Header": "value"\n    },\n    "strip_path": true,\n    "retry_attempts": 3,\n    "plugin_chain": [\n      {\n        "name": "rate_limiter",\n        "enabled": true,\n        "priority": 1,\n        "settings": {\n          "limit": 100,\n          "window": "1m"\n        }\n      }\n    ]\n  }\'\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,t.jsx)(n.h3,{id:"path-matching",children:"Path Matching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Exact matches: ",(0,t.jsx)(n.code,{children:"/v1/chat/completions"})]}),"\n",(0,t.jsxs)(n.li,{children:["Wildcards: ",(0,t.jsx)(n.code,{children:"/api/*"})]}),"\n",(0,t.jsxs)(n.li,{children:["Parameters: ",(0,t.jsx)(n.code,{children:"/users/:id"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"target-configuration",children:"Target Configuration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Single endpoint"}),"\n",(0,t.jsx)(n.li,{children:"Multiple endpoints with weights"}),"\n",(0,t.jsx)(n.li,{children:"Load balancing options"}),"\n",(0,t.jsx)(n.li,{children:"Health checks"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"http-methods",children:"HTTP Methods"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Supported: GET, POST, PUT, DELETE, PATCH"}),"\n",(0,t.jsx)(n.li,{children:"Method-specific configurations"}),"\n",(0,t.jsx)(n.li,{children:"Method restrictions"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"header-management",children:"Header Management"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Required headers"}),"\n",(0,t.jsx)(n.li,{children:"Header transformations"}),"\n",(0,t.jsx)(n.li,{children:"Header preservation"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"retry-policy",children:"Retry Policy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "retry_attempts": 3,\n  "retry_interval": "1s",\n  "retry_on": [500, 502, 503, 504]\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Path Design"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use clear, hierarchical paths"}),"\n",(0,t.jsx)(n.li,{children:"Consider versioning"}),"\n",(0,t.jsx)(n.li,{children:"Plan for future endpoints"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Security"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Limit exposed methods"}),"\n",(0,t.jsx)(n.li,{children:"Configure appropriate headers"}),"\n",(0,t.jsx)(n.li,{children:"Use HTTPS for targets"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Performance"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Enable path stripping when needed"}),"\n",(0,t.jsx)(n.li,{children:"Configure proper retry policies"}),"\n",(0,t.jsx)(n.li,{children:"Use load balancing for high availability"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Monitoring"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Track rule usage"}),"\n",(0,t.jsx)(n.li,{children:"Monitor target health"}),"\n",(0,t.jsx)(n.li,{children:"Set up alerts for failures"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var r=i(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);